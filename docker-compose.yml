services:
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: kubelens-server
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      # Database: Use DATABASE_URL for PostgreSQL/MySQL, or DATABASE_PATH for SQLite
      - DATABASE_PATH=/data/kubelens.db
      # - DATABASE_URL=postgres://user:pass@postgres:5432/kubelens?sslmode=disable
      - LOG_LEVEL=info
      - CORS_ORIGINS=http://localhost,http://localhost:80,http://app,http://app:80
      # OAuth2/SSO: Public URL for redirect URIs (callback: {PUBLIC_URL}/api/v1/auth/oauth/callback)
      - KUBELENS_PUBLIC_URL=http://localhost
      - KUBELENS_ADMIN_PASSWORD=admin123
      - KUBELENS_GLOBAL_RATE_LIMIT_PER_MIN=1000  # Global: 1000 requests/min
      - KUBELENS_LOGIN_RATE_LIMIT_PER_MIN=5      # Login: 5 requests/min
    volumes:
      - ./data:/data
    restart: unless-stopped
    networks:
      - kubelens

  app:
    build:
      context: .
      dockerfile: Dockerfile.app
    container_name: kubelens-app
    ports:
      - "80:80"
    environment:
      - PORT=80
      # - API_SERVER=https://api.kubelens.app
      - API_SERVER=http://server:8080
      - NODE_ENV=production
    depends_on:
      - server
    restart: unless-stopped
    networks:
      - kubelens

networks:
  kubelens:
    driver: bridge

volumes:
  data:

