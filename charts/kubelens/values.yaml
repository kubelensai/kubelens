# Kubelens Parent Chart Values
# This chart includes sub-charts (server, app)
# All configuration is done via sub-chart value overrides
#
# Note: OAuth2/OIDC is now handled by the built-in kubelens-oauth2 extension.
# Configure SSO providers via UI: Settings > Integrations > Extensions

# Global settings (inherited by all sub-charts)
global:
  imagePullSecrets: []

# Server sub-chart configuration
# See: charts/server/values.yaml for full configuration options
server:
  enabled: true
  replicaCount: 1
  
  image:
    repository: kubelensai/kubelens-server
    pullPolicy: IfNotPresent
    tag: "1.0.0"
  
  service:
    type: ClusterIP
    port: 8080
  
  ingress:
    enabled: false # Set to true to enable ingress
    className: ""
    annotations: {}
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: ""
        paths:
          - path: /
            pathType: Prefix
    tls: {}
      # - secretName: kubelens-app-secret
      #   hosts:
      #     - ""
  
  serviceAccount:
    create: true
    annotations: {}
    name: ""
  
  rbac:
    create: true
  
  resources:
    limits:
      cpu: 200m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  
  # Admin password for default admin user
  adminPassword: ""
  
  # Rate limiting
  rateLimit:
    global: 1000
    login: 5
  
  # Database configuration (SQLite by default)
  # For PostgreSQL or MySQL, see examples below
  database:
    type: postgresql
    sqlite:
      deploy: false
      builtin:
        path: /data/kubelens.db
        persistence:
          enabled: true
          storageClass: ""
          accessMode: ReadWriteOnce
          size: 1Gi
      external:
        path: ""  # e.g., /mnt/shared/kubelens.db
    postgresql:
      deploy: true
      external:
        host: ""           # e.g., postgres.example.com
        port: 5432
        database: kubelens
        user: kubelens
        password: ""       # External database password
        sslmode: require   # disable, require, verify-ca, verify-full
    mysql:
      deploy: false
      external:
        host: ""           # e.g., mysql.example.com
        port: 3306
        database: kubelens
        user: kubelens
        password: ""       # External database password
  
  # PostgreSQL sub-chart values (only used when database.postgresql.deploy: true)
  postgresql:
    auth:
      database: kubelens
      username: kubelens
      password: ""
      postgresPassword: ""
    primary:
      persistence:
        enabled: true
        size: 10Gi
  
  # MySQL sub-chart values (only used when database.mysql.deploy: true)
  mysql:
    auth:
      database: kubelens
      username: kubelens
      password: ""
      rootPassword: ""
    primary:
      persistence:
        enabled: true
        size: 10Gi
  
  env:
    - name: PORT
      value: "8080"
    - name: LOG_LEVEL
      value: "info"
  
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  
  securityContext:
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# App sub-chart configuration (Frontend)
# See: charts/app/values.yaml for full configuration options
app:
  enabled: true
  replicaCount: 1
  
  image:
    repository: kubelensai/kubelens-app
    pullPolicy: IfNotPresent
    tag: "1.0.0"
  
  service:
    type: ClusterIP
    port: 80
  
  ingress:
    enabled: false # Set to true to enable ingress
    className: ""
    annotations: {}
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: ""
        paths:
          - path: /
            pathType: Prefix
    tls: {}
      # - secretName: kubelens-app-secret
      #   hosts:
      #     - ""
  
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi
  
  # API Server URL - set to match server ingress
  env:
    apiServer: ""
  
  # Server service configuration for app to connect
  server:
    serviceName: ""  # Auto-detected from Release.Name
    servicePort: 8080
  
  podAnnotations: {}
  podSecurityContext: {}
  
  securityContext:
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
