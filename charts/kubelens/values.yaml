# Kubelens Parent Chart Values
# This chart includes sub-charts (dex, server, app)
# All configuration is done via sub-chart value overrides

# Global settings (inherited by all sub-charts)
global:
  imagePullSecrets: []

# Dex sub-chart configuration (OAuth2/OIDC provider)
# See: https://github.com/dexidp/helm-charts
dex:
  enabled: true
  replicaCount: 1
  
  image:
    repository: ghcr.io/dexidp/dex
    tag: v2.37.0
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    ports:
      http:
        port: 5556
      grpc:
        port: 5557
      telemetry:
        port: 5558
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  envVars:
    - name: GOOGLE_CLIENT_ID
      value: ""  # Set via: --set dex.envVars[0].value=YOUR_CLIENT_ID
    - name: GOOGLE_CLIENT_SECRET
      value: ""  # Set via: --set dex.envVars[1].value=YOUR_CLIENT_SECRET
  
  config:
    issuer: http://dex:5556/dex
    
    storage:
      type: kubernetes
      config:
        inCluster: true
    
    web:
      http: 0.0.0.0:5556
    
    grpc:
      addr: 0.0.0.0:5557
    
    telemetry:
      http: 0.0.0.0:5558
    
    staticClients:
      - id: kubelens
        redirectURIs:
          - 'http://localhost/auth/callback'
        name: 'Kubelens'
        secret: kubelens-secret-change-in-production
    
    connectors:
      - type: google
        id: google
        name: Google
        config:
          clientID: $GOOGLE_CLIENT_ID
          clientSecret: $GOOGLE_CLIENT_SECRET
          redirectURI: http://dex:5556/dex/callback
          scopes:
            - profile
            - email
            - openid
            - https://www.googleapis.com/auth/cloud-platform.read-only

# Server sub-chart configuration
# See: charts/server/values.yaml for full configuration options
server:
  enabled: true
  replicaCount: 1
  
  image:
    repository: kubelensai/kubelens-server
    pullPolicy: Always
    tag: "latest"
  
  service:
    type: ClusterIP
    port: 8080
  
  ingress:
    enabled: false # Set to true to enable ingress
    className: ""
    annotations: {}
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: ""
        paths:
          - path: /
            pathType: Prefix
    tls: {}
      # - secretName: kubelens-app-secret
      #   hosts:
      #     - ""
  
  serviceAccount:
    create: true
    annotations: {}
    name: ""
  
  rbac:
    create: true
  
  resources:
    limits:
      cpu: 200m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  
  # Admin password for default admin user
  adminPassword: ""
  
  # Rate limiting
  rateLimit:
    global: 1000
    login: 5
  
  # Database configuration (SQLite by default)
  # For PostgreSQL or MySQL, see examples below
  database:
    type: postgresql
    sqlite:
      deploy: false
      builtin:
        path: /data/kubelens.db
        persistence:
          enabled: true
          storageClass: ""
          accessMode: ReadWriteOnce
          size: 1Gi
      external:
        path: ""  # e.g., /mnt/shared/kubelens.db
    postgresql:
      deploy: true
      external:
        host: ""           # e.g., postgres.example.com
        port: 5432
        database: kubelens
        user: kubelens
        password: ""       # External database password
        sslmode: require   # disable, require, verify-ca, verify-full
    mysql:
      deploy: false
      external:
        host: ""           # e.g., mysql.example.com
        port: 3306
        database: kubelens
        user: kubelens
        password: ""       # External database password
  
  # PostgreSQL sub-chart values (only used when database.postgresql.deploy: true)
  postgresql:
    auth:
      database: kubelens
      username: kubelens
      password: ""
      postgresPassword: ""
    primary:
      persistence:
        enabled: true
        size: 10Gi
  
  # MySQL sub-chart values (only used when database.mysql.deploy: true)
  mysql:
    auth:
      database: kubelens
      username: kubelens
      password: ""
      rootPassword: ""
    primary:
      persistence:
        enabled: true
        size: 10Gi
  
  env:
    - name: PORT
      value: "8080"
    - name: LOG_LEVEL
      value: "info"
  
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  
  securityContext:
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

# App sub-chart configuration (Frontend)
# See: charts/app/values.yaml for full configuration options
app:
  enabled: true
  replicaCount: 1
  
  image:
    repository: kubelensai/kubelens-app
    pullPolicy: Always
    tag: "latest"
  
  service:
    type: ClusterIP
    port: 80
  
  ingress:
    enabled: false # Set to true to enable ingress
    className: ""
    annotations: {}
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: ""
        paths:
          - path: /
            pathType: Prefix
    tls: {}
      # - secretName: kubelens-app-secret
      #   hosts:
      #     - ""
  
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi
  
  # API Server URL - set to match server ingress
  env:
    apiServer: ""
  
  # Server service configuration for app to connect
  server:
    serviceName: ""  # Auto-detected from Release.Name
    servicePort: 8080
  
  podAnnotations: {}
  podSecurityContext: {}
  
  securityContext:
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
